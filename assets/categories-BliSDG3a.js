import{r as a,j as e,D as L,a as q,b as T,c as z,L as D,T as E,B as o,d as I,i as f,t as u}from"./index-BH7dFSJV.js";import{I as w}from"./input-DaXfPNSL.js";import{C as B}from"./ConfirmDialog-youmeBNQ.js";function H({category:C,open:p,onOpenChange:g,onSave:v}){const[h,N]=a.useState(C.name),[c,r]=a.useState(C.description),[y,n]=a.useState(!1),[m,i]=a.useState(null),x=async s=>{s.preventDefault(),n(!0),i(null);try{await v({name:h,description:c}),g(!1)}catch(d){i(d instanceof Error?d.message:"Failed to update category")}finally{n(!1)}};return e.jsx(L,{open:p,onOpenChange:g,children:e.jsxs(q,{children:[e.jsx(T,{children:e.jsx(z,{children:"Edit Category"})}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"name",children:"Name"}),e.jsx(w,{id:"name",value:h,onChange:s=>N(s.target.value),placeholder:"Enter category name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"description",children:"Description"}),e.jsx(E,{id:"description",value:c,onChange:s=>r(s.target.value),placeholder:"Enter category description",required:!0})]}),m&&e.jsx("div",{className:"text-sm text-destructive",children:m}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:y,children:y?"Saving...":"Save Changes"})]})]})]})})}const G=function(){const[p,g]=a.useState([]),[v,h]=a.useState(!0),[N,c]=a.useState(!1),[r,y]=a.useState(null),[n,m]=a.useState(null),[i,x]=a.useState(null),[s,d]=a.useState({name:"",description:""}),[S,l]=a.useState(null);a.useEffect(()=>{j(),F()},[]);const F=async()=>{try{const t=await I.getCurrentUser();y(t.data),l(null)}catch(t){l("Failed to load user information"),console.error(t)}},j=async()=>{try{const t=await f.getCategories({page:1,pageSize:100});g(t.data),l(null)}catch(t){l("Failed to load categories"),console.error(t)}finally{h(!1)}},A=()=>{c(!0),d({name:"",description:""}),l(null)},k=async t=>{t.preventDefault();try{await f.createCategory(s),c(!1),j(),l(null),u.success("Category created successfully")}catch(b){l("Failed to create category"),u.error("Failed to create category"),console.error(b)}};return e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Categories"}),(r==null?void 0:r.role)==="admin"&&e.jsx(o,{onClick:A,children:"Add Category"})]}),v?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:p.length>0?p.map(t=>e.jsxs("div",{className:"rounded-lg border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:t.description||"No description"}),(r==null?void 0:r.role)==="admin"&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>m(t),children:"Edit"}),e.jsx(o,{variant:"outline",size:"sm",className:"text-red-600",onClick:()=>x(t),children:"Delete"})]})]},t.id)):e.jsx("div",{className:"md:col-span-2 lg:col-span-3",children:e.jsx("p",{className:"text-center text-gray-500",children:"No categories found"})})}),N&&e.jsx("div",{className:"fixed p-4 inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Add Category"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx("div",{children:e.jsx(w,{value:s.name,onChange:t=>d({...s,name:t.target.value}),placeholder:"Category name",required:!0})}),e.jsx("div",{children:e.jsx(E,{value:s.description,onChange:t=>d({...s,description:t.target.value}),placeholder:"Category description",required:!0})}),S&&e.jsx("p",{className:"text-red-500",children:S}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(o,{type:"submit",children:"Add Category"})]})]})]})}),n&&e.jsx(H,{category:n,open:!!n,onOpenChange:t=>!t&&m(null),onSave:async t=>{try{await f.updateCategory(n.id,t),u.success("Category updated successfully"),j()}catch(b){throw u.error("Failed to update category"),b}}}),i&&e.jsx(B,{open:!!i,onOpenChange:t=>!t&&x(null),title:"Delete Category",description:`Are you sure you want to delete '${i.name}'? This action cannot be undone.`,confirmLabel:"Delete",variant:"destructive",onConfirm:async()=>{try{await f.deleteCategory(i.id),u.success("Category deleted successfully"),j(),x(null)}catch(t){u.error(t instanceof Error?t.message:"Failed to delete category")}}})]})};export{G as component};
